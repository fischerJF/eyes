<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Data Vizualization - Final Project</title>

    <!-- Bootstrap core CSS -->
    <link href="../vendors/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../vendors/css/dashboard.css" rel="stylesheet">
    <style type="text/css">

      .axis path,
      .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
      }

      .axis text {
        font-family: sans-serif;
        font-size: 11px;
      }

      .dot {
        stroke: #000;
      }

      .legend {
        padding: 5px;
        font: 10px sans-serif;
        background: yellow;
        box-shadow: 2px 2px 1px #888;
      }

    </style>
  </head>

  <body>
    <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
      <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#">Dashboard</a>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Help</a>
          </li>
        </ul>
        <form class="form-inline mt-2 mt-md-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-sm-3 col-md-2 hidden-xs-down bg-faded sidebar">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../coordenadasParalelas/index.html">Overview </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../circles/index.html">Categories</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../scatter/index.html">Subst msgs / Deprecated elements</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#">Deprecated elements<span class="sr-only">(current)</span></a>
            </li>
          </ul>
        </nav>

        <main class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 pt-3">
          <h1>Deprecated Elements</h1>
          <div class="row">
            <div class="col-sm-12" id="mbars"></div>
          </div>
        </main>
      </div>
    </div>

    <script src="../vendors/js/d3/d3.min.js"></script>
    <script src="../vendors/js/jquery-3.1.1.slim.min.js"></script>
    <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../vendors/js/tether.min.js"></script>
    <script src="../vendors/js/bootstrap.min.js"></script>
    <script src="../vendors/js/ie10-viewport-bug-workaround.js"></script>

    <script>
      //link dessa visualiza√ßao: http://bl.ocks.org/anupsavvy/9513382
      //var w = 600;                        //width
      //var h = 500;                        //height
      // margin = {top: 20, right: 50, bottom: 30, left: 80};
      // var w = window.innerWidth;
      // var h = window.innerHeight/1.5;
      var padding = {top: 40, right: 40, bottom: 40, left:40};
      var w = (d3.select("#mbars").node().offsetWidth) - padding.left - padding.right;
      var h = (window.innerHeight/1.5) - padding.top - padding.bottom;
      var dataset;
      //Set up stack method
      var stack = d3.stack;


      d3.csv("./data/dataVisualization.csv", function(error, inputData) {
        if (error) alert("Problema para ler os dados de entrada!");
        data = inputData;
        //Data, stacked
        stack(data);

        var color_hash = {
          0 : ["Fields","#1f77b4"],
          1 : ["Methods","#2ca02c"],
          2 : ["Types","#ff7f0e"]
        };


        //Set up scales
        var xScale = d3.scaleBand()
          .rangeRound([0, w-padding.left-padding.right]);
        // var xScale = d3.time.scale()
        //   .domain([new Date(dataset[0][0].time),d3.time.day.offset(new Date(dataset[0][dataset[0].length-1].time),8)])
        //   .rangeRound([0, w-padding.left-padding.right]);

        var yScale = d3.scaleLinear()
          .domain([0,
            d3.max(data, function(d) {
              return (d3.max(d["quantElementsDeprecated_last"]));
            })])
          .range([h-padding.bottom-padding.top,0]);

        var xAxis = d3.axisBottom(xScale);
        var yAxis = d3.axisLeft(yScale);

        //Easy colors accessible via a 10-step ordinal scale
        var colors = d3.scaleOrdinal(d3.schemeCategory10);

        //Create SVG element
        var svg = d3.select("#mbars")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

        // Add a group for each row of data
        var groups = svg.selectAll("g")
          .data(data)
          .enter()
          .append("g")
          .attr("class","rgroups")
          .attr("transform","translate("+ padding.left + "," + (h - padding.bottom) +")")
          .style("fill", function(d, i) {
            console.log(color_hash);
            console.log(d);
            console.log(i);
            // return color_hash[data.indexOf(d)][1];
          });

        // Add a rect for each data value
        var rects = groups.selectAll("rect")
          .data(function(d) { return d; })
          .enter()
          .append("rect")
          .attr("width", 2)
          .style("fill-opacity",1e-6);

        // rects.transition()
        //    .duration(function(d,i){
        //       return 500 * i;
        //     })
        //     .ease("linear")
        //     .attr("x", function(d) {
        //       return xScale(new Date(d.time));
        //     })
        //     .attr("y", function(d) {
        //       return -(- yScale(d.y0) - yScale(d.y) + (h - padding.top - padding.bottom)*2);
        //   })
        //   .attr("height", function(d) {
        //     return -yScale(d.y) + (h - padding.top - padding.bottom);
        //   })
        //   .attr("width", 15)
        //   .style("fill-opacity",1);

        // svg.append("g")
        //   .attr("class","x axis")
        //   .attr("transform","translate(40," + (h - padding.bottom) + ")")
        //   .call(xAxis);

        // svg.append("g")
        //   .attr("class","y axis")
        //   .attr("transform","translate(" + padding.left + "," + padding.top + ")")
        //   .call(yAxis);

        // adding legend

        // var legend = svg.append("g")
        //         .attr("class","legend")
        //         .attr("x", w - padding.right - 65)
        //         .attr("y", 25)
        //         .attr("height", 100)
        //         .attr("width",100);

        // legend.selectAll("g").data(dataset)
        //     .enter()
        //     .append('g')
        //     .each(function(d,i){
        //       var g = d3.select(this);
        //       g.append("rect")
        //         .attr("x", w - padding.right - 65)
        //         .attr("y", i*25 + 10)
        //         .attr("width", 10)
        //         .attr("height",10)
        //         .style("fill",color_hash[String(i)][1]);

        //       g.append("text")
        //        .attr("x", w - padding.right - 50)
        //        .attr("y", i*25 + 20)
        //        .attr("height",30)
        //        .attr("width",100)
        //        .style("fill",color_hash[String(i)][1])
        //        .text(color_hash[String(i)][0]);
        //     });

        // svg.append("text")
        // .attr("transform","rotate(-90)")
        // .attr("y", 0 - 5)
        // .attr("x", 0-(h/2))
        // .attr("dy","1em")
        // .text("Number of Messages");

    //   svg.append("text")
    //      .attr("class","xtext")
    //      .attr("x",w/2 - padding.left)
    //      .attr("y",h - 5)
    //      .attr("text-anchor","middle")
    //      .text("Days");

    //   svg.append("text")
    //       .attr("class","title")
    //       .attr("x", (w / 2))             
    //       .attr("y", 20)
    //       .attr("text-anchor", "middle")  
    //       .style("font-size", "16px") 
    //       .style("text-decoration", "underline")  
    //       .text("Number of messages per day.");

    //   //On click, update with new data      
    //   d3.selectAll(".m")
    //     .on("click", function() {
    //       var date = this.getAttribute("value");

    //       var str;
    //       if(date == "2014-02-19"){
    //         str = "19.json";
    //       }else if(date == "2014-02-20"){
    //         str = "20.json";
    //       }else if(date == "2014-02-21"){
    //         str = "21.json";
    //       }else if(date == "2014-02-22"){
    //         str = "22.json";
    //       }else{
    //         str = "23.json";
    //       }

    //       d3.json(str,function(json){

    //         dataset = json;
    //         stack(dataset);

    //         console.log(dataset);

    //         xScale.domain([new Date(0, 0, 0,dataset[0][0].time,0, 0, 0),new Date(0, 0, 0,dataset[0][dataset[0].length-1].time,0, 0, 0)])
    //         .rangeRound([0, w-padding.left-padding.right]);

    //         yScale.domain([0,       
    //                 d3.max(dataset, function(d) {
    //                   return d3.max(d, function(d) {
    //                     return d.y0 + d.y;
    //                   });
    //                 })
    //               ])
    //               .range([h-padding.bottom-padding.top,0]);

    //         xAxis.scale(xScale)
    //              .ticks(d3.time.hour,2)
    //              .tickFormat(d3.time.format("%H"));

    //         yAxis.scale(yScale)
    //              .orient("left")
    //              .ticks(10);

    //          groups = svg.selectAll(".rgroups")
    //                     .data(dataset);

    //                     groups.enter().append("g")
    //                     .attr("class","rgroups")
    //                     .attr("transform","translate("+ padding.left + "," + (h - padding.bottom) +")")
    //                     .style("fill",function(d,i){
    //                         return color(i);
    //                     });


    //                     rect = groups.selectAll("rect")
    //                     .data(function(d){return d;});

    //                     rect.enter()
    //                       .append("rect")
    //                       .attr("x",w)
    //                       .attr("width",1)
    //                       .style("fill-opacity",1e-6);

    //                 rect.transition()
    //                     .duration(1000)
    //                     .ease("linear")
    //                     .attr("x",function(d){
    //                         return xScale(new Date(0, 0, 0,d.time,0, 0, 0));
    //                     })
    //                     .attr("y",function(d){
    //                         return -(- yScale(d.y0) - yScale(d.y) + (h - padding.top - padding.bottom)*2);
    //                     })
    //                     .attr("height",function(d){
    //                         return -yScale(d.y) + (h - padding.top - padding.bottom);
    //                     })
    //                     .attr("width",15)
    //                     .style("fill-opacity",1);

    //                 rect.exit()
    //              .transition()
    //              .duration(1000)
    //              .ease("circle")
    //              .attr("x",w)
    //              .remove();

    //                 groups.exit()
    //              .transition()
    //              .duration(1000)
    //              .ease("circle")
    //              .attr("x",w)
    //              .remove();


    //         svg.select(".x.axis")
    //            .transition()
    //            .duration(1000)
    //            .ease("circle")
    //            .call(xAxis);

    //         svg.select(".y.axis")
    //            .transition()
    //            .duration(1000)
    //            .ease("circle")
    //            .call(yAxis);

    //         svg.select(".xtext")
    //            .text("Hours");

    //         svg.select(".title")
    //             .text("Number of messages per hour on " + date + ".");
    //       });     
    //     });


    });








    </script>
  </body>
</html>
